<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <f:metadata>
        <f:viewParam name="movieShowId"
                     value="#{movieShowSelectorBean.selectedMovieShowId}" />
        <f:viewParam name="theatreId"
                     value="#{movieShowSelectorBean.theatreId}" />
    </f:metadata>
    <h:head>
    </h:head>
    <h:body styleClass="bodystyle">
        <ui:composition template="/templates/masterLayout.xhtml">
            <ui:define name="content">
                <b:jumbotron styleClass="content">
                    <b:container styleClass="content">
                        <h1 style="color: white;">Foglalás</h1>
                        <b:column
                            style=" background: #e8fff4; border: #00494c; border-radius: 5px; border-width: 5px; color: #00494c; padding: 10px;">
                            <b:container>
                                <h:form id="form">
                                    <b:row styleClass="show-grid">
                                        <b:column col-xs="12" col-sm="6" col-md="8">
                                            <table>
                                                <ui:repeat value="#{bookSeatBean.seats}" var="seatList"
                                                           varStatus="status">
                                                    <tr>
                                                        <ui:repeat value="#{seatList}" var="seat">
                                                            <td><b:commandButton
                                                                    value="(#{seat.seatRow},#{seat.seatColumn})"
                                                                    style="background-color: #{bookSeatBean.occupiedSeats.contains(seat) ? bookSeatBean.selectedSeats.contains(seat) ? 'orange' : 'red' : 'green'};"
                                                                    immediate="true"
                                                                    onclick="ajax:bookSeatBean.occupyOrFree(seat.seatRow, seat.seatColumn);javascript:send(theatreId, movieShowId,#{seat.id}, #{!bookSeatBean.selectedSeats.contains(seat)});"
                                                                    ajax="true" update="@form" /></td>
                                                        </ui:repeat>
                                                    </tr>
                                                </ui:repeat>
                                            </table>
                                            <b:commandButton id="upbutton" value="Update" immediate="true"
                                                             onclick="ajax:bookSeatBean.update()" ajax="true"
                                                             style="display: none;" update="@form" />
                                            <b:commandButton id="downbutton" value="Foglalások Törlése"
                                                             immediate="true" onclick="ajax:bookSeatBean.delete();"
                                                             ajax="true" update="@form" />
                                            <o:commandScript name="update" action="#{bookSeatBean.update}"
                                                             render="@form"></o:commandScript>
                                            <o:commandScript name="reload" action="#{bookSeatBean.reload}"></o:commandScript>

                                        </b:column>
                                        <b:column col-xs="6" col-sm="6" col-md="4">

                                            <b:inputText label="Név" placeholder="Név" required="true"
                                                         render-label="true" value="#{bookSeatBean.guestName}">
                                            </b:inputText>

                                            <b:inputText label="Telefonszám" placeholder="Telefonszám"
                                                         required="true" render-label="true"
                                                         value="#{bookSeatBean.guestPhone}">
                                            </b:inputText>

                                            <b:inputText label="E-mail" placeholder="E-mail" required="true"
                                                         render-label="true" value="#{bookSeatBean.guestEmail}">
                                            </b:inputText>

                                            <b:inputText label="Irányítószám" placeholder="Irányítószám"
                                                         required="true" render-label="true"
                                                         value="#{bookSeatBean.guestZip}">
                                            </b:inputText>

                                            <b:commandButton id="accept" update="@form"
                                                             value="Foglalások Véglegesítése"
                                                             action="#{bookSeatBean.save}" />

                                        </b:column>
                                    </b:row>
                                </h:form>
                                <h:outputScript library="js" name="socket.js" target="body" />
                                <h:outputStylesheet library="css" name="reservation.css" />
                            </b:container>
                        </b:column>
                    </b:container>
                </b:jumbotron>
            </ui:define>
        </ui:composition>
    </h:body>
</html>